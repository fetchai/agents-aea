name: AEA framework sanity checks and tests

on:
  push:
    branches:
      - develop
      - master
  pull_request:

jobs:
  one-test:
     runs-on: ubuntu-latest
     steps:
     - uses: actions/checkout@master
     - uses: actions/setup-python@master
       with:
        python-version: 3.8
     - name: Install dependencies (ubuntu-latest)
       run: |
        sudo apt-get update --fix-missing
        sudo apt-get autoremove
        sudo apt-get autoclean
        pip install pipenv
        pip install tox
        sudo apt-get install -y protobuf-compiler

        # install IPFS
        sudo apt-get install -y wget
        wget -O ./go-ipfs.tar.gz https://dist.ipfs.io/go-ipfs/v0.4.23/go-ipfs_v0.4.23_linux-amd64.tar.gz
        tar xvfz go-ipfs.tar.gz
        sudo mv go-ipfs/ipfs /usr/local/bin/ipfs
        ipfs init
     - name: Unit tests and coverage
       run: |
        tox -e py3.8_defaults -- --durations 100
